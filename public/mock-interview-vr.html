<!-- Simple A-Frame VR Interview Room Example -->
<html>
  <head>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <title>Mock Interview VR Room</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body style="margin:0;">
    <a-scene>
      <a-entity cursor="rayOrigin: mouse"></a-entity>
      <!-- Floor -->
      <a-plane position="0 0 0" rotation="-90 0 0" width="8" height="8" color="#ece9fc"></a-plane>
      <!-- Interview Table -->
      <a-box position="0 0.5 -1.5" depth="1" height="0.2" width="2" color="#bba6f7"></a-box>
      <!-- Chair for User -->
      <a-box position="0 0.25 1.5" depth="1" height="0.5" width="1" color="#7b2ff2"></a-box>
      <!-- Panel Interview Simulation: Multiple Interviewers -->
      <a-sphere id="mrnanny" position="-1.2 1.2 -2.5" radius="0.5" color="#ffd700"></a-sphere>
      <a-text value="Mr. Nanny" position="-1.2 2 -2.5" align="center" color="#232526"></a-text>
      <a-sphere position="0 1.2 -2.5" radius="0.5" color="#bba6f7"></a-sphere>
      <a-text value="Ms. AI" position="0 2 -2.5" align="center" color="#232526"></a-text>
      <a-sphere position="1.2 1.2 -2.5" radius="0.5" color="#7b2ff2"></a-sphere>
      <a-text value="Dr. Tech" position="1.2 2 -2.5" align="center" color="#232526"></a-text>
      <!-- Floating Question Buttons -->
            <!-- Need Training Button -->
                  <!-- Voice Recording Controls -->
                  <a-box id="record-btn" position="-1.5 0.4 1" depth="0.2" height="0.4" width="1.2" color="#7b2ff2" class="clickable">
                    <a-text value="Record Answer" align="center" color="#fff" position="0 0 0.15" width="2"></a-text>
                  </a-box>
                  <a-box id="play-btn" position="1.5 0.4 1" depth="0.2" height="0.4" width="1.2" color="#bba6f7" class="clickable">
                    <a-text value="Play Answer" align="center" color="#232526" position="0 0 0.15" width="2"></a-text>
                  </a-box>
                  <a-text id="rec-status" value="" align="center" color="#ff0000" position="0 0.1 1" width="4"></a-text>
            <a-box id="training-btn" position="0 0.7 1" depth="0.2" height="0.4" width="1.4" color="#ffd700" class="clickable">
              <a-text value="Need Training?" align="center" color="#232526" position="0 0 0.15" width="2"></a-text>
            </a-box>
      <a-box id="q1" position="-2 1.2 -1.5" depth="0.2" height="0.5" width="1.2" color="#7b2ff2" class="clickable" event-set__enter="scale: 1.1 1.1 1.1" event-set__leave="scale: 1 1 1">
        <a-text value="Start Interview" align="center" color="#fff" position="0 0 0.15" width="2"></a-text>
      </a-box>
      <a-box id="q2" position="2 1.2 -1.5" depth="0.2" height="0.5" width="1.2" color="#bba6f7" class="clickable" event-set__enter="scale: 1.1 1.1 1.1" event-set__leave="scale: 1 1 1">
        <a-text value="Next Question" align="center" color="#232526" position="0 0 0.15" width="2"></a-text>
      </a-box>
      <!-- Question Display Panel -->
      <a-entity id="question-panel">
        <a-text id="welcome-text" value="Welcome! Ready for your mock interview?\nType your answer below or use the command bar!" align="center" color="#7b2ff2" position="0 2.3 -1.5" width="5"></a-text>
        <a-text id="question-text" value="" align="center" color="#232526" position="0 1.7 -1.5" width="4"></a-text>
        <a-text id="timer-text" value="" align="center" color="#7b2ff2" position="0 2.1 -1.5" width="2"></a-text>
        <a-entity id="feedback-container" position="0 3.1 -2.5">
          <a-plane color="#222" width="5.5" height="0.7" opacity="0.85" position="0 0 0"></a-plane>
          <a-text id="feedback-text" value="" align="center" color="#ffe066" position="0 0 0.01" width="5.2" wrap-count="36" baseline="center" font-weight="bold" font="https://cdn.aframe.io/fonts/Exo2Bold.fnt" side="double" shader="msdf"></a-text>
        </a-entity>
        <a-text id="training-text" value="" align="center" color="#7b2ff2" position="0 0.9 -1.5" width="4"></a-text>
          function handleCommand() {
            const input = document.getElementById('command-input');
            const feedback = document.getElementById('command-feedback');
            if (!input || !feedback) return;
            const cmd = input.value.trim().toLowerCase();
            input.value = '';
            feedback.textContent = '';
            if (!cmd) return;
            if (cmd === 'start' || cmd === 'start interview' || cmd === 'yes' || cmd === 'ready') {
              window.startInterview();
              feedback.textContent = 'Interview started!';
            } else if (cmd === 'next' || cmd === 'next question') {
              window.nextQuestion();
              feedback.textContent = 'Next question.';
            } else if (cmd === 'training' || cmd === 'need training') {
              window.showTraining();
              feedback.textContent = 'Training tip shown.';
            } else if (cmd === 'help') {
              feedback.textContent = 'Commands: start, next, training, help';
            } else {
              feedback.textContent = 'Unknown command.';
            }
          }
          document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('command-input');
            if (input) {
              input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') handleCommand();
              });
            }
            // Command bar event listener
            const answerInput = document.getElementById('answer-input');
            if (answerInput) {
              answerInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') submitAnswer();
              });
            }
          ["Why should we hire you?", "Tip: Highlight your unique skills and how they match the job requirements."],
          ["Tell me about a time you worked in a team.", "Tip: Focus on collaboration, communication, and your role in the team's success."],
          ["How do you handle stress or pressure?", "Tip: Give examples of coping strategies and staying productive under pressure."],
          ["What motivates you?", "Tip: Share what drives you professionally and how it relates to the job."],
          ["Do you have any questions for us?", "Tip: Prepare thoughtful questions that show your interest in the company and role."]
        ];
        var questions = [], feedbacks = [];
        function shuffle(array) {
          for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
          }
        }
        var current = 0;
        var timer = null;
        var timeLeft = 0;
        var qText = document.querySelector('#question-text');
        var timerText = document.querySelector('#timer-text');
        var feedbackText = document.querySelector('#feedback-text');
        var trainingText = document.querySelector('#training-text');
        var userAnswerText = document.getElementById('user-answer-text');
        var trainingTips = [
          "Practice answering aloud and record yourself for review.",
          "Review common interview questions and sample answers.",
          "Use the STAR method (Situation, Task, Action, Result) for behavioral questions.",
          "Research the company and role before your interview.",
          "Check out the Training section on our website for more help!"
        ];
        function speak(text) {
          if ('speechSynthesis' in window) {
            var utter = new window.SpeechSynthesisUtterance(text);
            utter.rate = 1.05;
            utter.pitch = 1.1;
            window.speechSynthesis.speak(utter);
          }
        }
        function animateNod() {
          var avatar = document.getElementById('mrnanny');
          if (!avatar) return;
          var t = 0, nods = 0;
          var nod = setInterval(function() {
            t += 0.1;
            var y = 1.2 + 0.15 * Math.sin(t * 6);
            avatar.setAttribute('position', `-1.2 ${y} -2.5`);
            if (t > 1.2) { clearInterval(nod); avatar.setAttribute('position', '-1.2 1.2 -2.5'); }
          }, 30);
        }
        function startTimer(duration) {
          timeLeft = duration;
          animateNod();
          if (timer) clearInterval(timer);
          timerText.setAttribute('value', 'Time: ' + timeLeft + 's');
          timer = setInterval(function() {
            timeLeft--;
            timerText.setAttribute('value', 'Time: ' + timeLeft + 's');
            if (timeLeft <= 0) {
              clearInterval(timer);
              timerText.setAttribute('value', 'Time is up!');
              feedbackText.setAttribute('value', 'Sample answer: ' + feedbacks[current]);
              trainingText.setAttribute('value', 'Training: ' + trainingTips[Math.floor(Math.random()*trainingTips.length)]);
            }
          }, 1000);
        }
        // Voice recording logic
        let mediaRecorder, audioChunks = [], audioBlob, audioUrl, audio;
        function updateRecStatus(msg) {
          document.getElementById('rec-status').setAttribute('value', msg);
        }
        var recordBtn = document.getElementById('record-btn');
        var playBtn = document.getElementById('play-btn');
        var recStatus = document.getElementById('rec-status');
        if (recordBtn) recordBtn.addEventListener('click', function() {
          if (mediaRecorder && mediaRecorder.state === 'recording') {
            mediaRecorder.stop();
            updateRecStatus('Recording stopped.');
            return;
          }
          if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ audio: true }).then(function(stream) {
              mediaRecorder = new MediaRecorder(stream);
              audioChunks = [];
              mediaRecorder.ondataavailable = function(e) {
                audioChunks.push(e.data);
              };
              mediaRecorder.onstop = function() {
                audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                audioUrl = URL.createObjectURL(audioBlob);
                audio = new Audio(audioUrl);
                updateRecStatus('Recording saved. Click Play to listen.');
              };
              mediaRecorder.start();
              updateRecStatus('Recording... Click again to stop.');
            }).catch(function(err) {
              updateRecStatus('Microphone access denied.');
            });
          } else {
            updateRecStatus('Recording not supported.');
          }
        });
        if (playBtn) playBtn.addEventListener('click', function() {
          if (audio) {
            audio.play();
            updateRecStatus('Playing your answer...');
            audio.onended = function() { updateRecStatus('Playback finished.'); };
          } else {
            updateRecStatus('No recording found.');
          }
        });
        // Show all questions in the floating panel and highlight current
        const allQuestionsText = document.getElementById('all-questions-text');
        const currentQHighlight = document.getElementById('current-q-highlight');
        function updateQuestionsPanel() {
          if (allQuestionsText && Array.isArray(questions)) {
            allQuestionsText.setAttribute('value', 'All Questions:\n' + questions.map((q,i)=> (i+1)+'. '+q).join('\n'));
          }
          if (currentQHighlight && typeof current === 'number') {
            let lines = questions.map((q,i)=> (i===current?((i+1)+'. '+q):'')).join('\n');
            currentQHighlight.setAttribute('value', lines);
          }
        }
        // Global functions for A-Frame onclick and command bar
        window.startInterview = function() {
          let pool = questionPool.slice();
          shuffle(pool);
          questions = pool.map(qf => qf[0]);
          feedbacks = pool.map(qf => qf[1]);
          current = 0;
          qText.setAttribute('value', questions[current]);
          feedbackText.setAttribute('value', '');
          trainingText.setAttribute('value', '');
          userAnswerText.setAttribute('value', '');
          document.getElementById('welcome-text').setAttribute('value', 'Good luck! You can do it!');
          speak(questions[current]);
          startTimer(60);
          updateQuestionsPanel();
        };
        window.nextQuestion = function() {
          current = (current + 1) % questions.length;
          qText.setAttribute('value', questions[current]);
          feedbackText.setAttribute('value', '');
          trainingText.setAttribute('value', '');
          userAnswerText.setAttribute('value', '');
          document.getElementById('welcome-text').setAttribute('value', 'Keep going! You are doing great!');
          speak(questions[current]);
          startTimer(60);
          updateQuestionsPanel();
        };
        window.showTraining = function() {
          trainingText.setAttribute('value', 'Training: ' + trainingTips[Math.floor(Math.random()*trainingTips.length)]);
        };
        // Command handler for text input
        function handleCommand() {
          const input = document.getElementById('command-input');
          const feedback = document.getElementById('command-feedback');
          if (!input || !feedback) return;
          const cmd = input.value.trim().toLowerCase();
          input.value = '';
          feedback.textContent = '';
          if (!cmd) return;
          if (cmd === 'start' || cmd === 'start interview' || cmd === 'yes' || cmd === 'ready') {
            window.startInterview();
            feedback.textContent = 'Interview started!';
          } else if (cmd === 'next' || cmd === 'next question') {
            window.nextQuestion();
            feedback.textContent = 'Next question.';
          } else if (cmd === 'training' || cmd === 'need training') {
            window.showTraining();
            feedback.textContent = 'Training tip shown.';
          } else if (cmd === 'help') {
            feedback.textContent = 'Commands: start, next, training, help';
          } else {
            feedback.textContent = 'Unknown command.';
          }
        }
        document.addEventListener('DOMContentLoaded', function() {
          const input = document.getElementById('command-input');
          if (input) {
            input.addEventListener('keydown', function(e) {
              if (e.key === 'Enter') handleCommand();
            });
          }
        });
        // User answer logic
        const answerInput = document.getElementById('answer-input');
        const answerFeedback = document.getElementById('answer-feedback');
        // Store user answers for summary
        let userAnswers = [];
        // Top 10 best practices for interview answers
        const bestPractices = [
          'specific',
          'example',
          'experience',
          'skills',
          'problem',
          'solution',
          'team',
          'collaborat',
          'challenge',
          'learn',
          'company',
          'industry',
          'motivat',
          'goal',
          'honest',
          'strength',
          'weakness',
          'enthusias',
          'positive',
          'communicat',
        ];
        let answerScores = [];
        // Track consecutive bad answers
        let badStreak = 0;
        function submitAnswer() {
          const answer = answerInput.value.trim();
          if (!answer) {
            answerFeedback.textContent = 'Please type an answer.';
            return;
          }
          userAnswers[current] = answer;
          userAnswerText.setAttribute('value', 'Your answer: ' + answer);
          // Score answer by best practices
          let matchCount = 0;
          let matchedPractices = [];
          const answerLower = answer.toLowerCase();
          for (const practice of bestPractices) {
            if (answerLower.includes(practice)) {
              matchCount++;
              matchedPractices.push(practice);
            }
          }
          let score = matchCount;
          answerScores[current] = score;
          // Feedback and bad streak logic
          let aiEval = '';
          if (score >= 3) {
            aiEval = 'Great answer! You covered several best practices.';
            badStreak = 0;
          } else if (score === 2) {
            aiEval = 'Decent answer. Try to include more examples or details.';
            badStreak = 0;
          } else if (score === 1) {
            aiEval = 'Needs improvement. Try to address more key points.';
            badStreak++;
          } else {
            aiEval = 'Try to include specific examples, skills, or experiences.';
            badStreak++;
          }
          let referral = '';
          if (badStreak >= 3) {
            referral = '\n\nIt looks like you might benefit from more interview guidance. Please visit Mr. Nanny in the Resume Room for tips and techniques!';
            badStreak = 0;
          }
          feedbackText.setAttribute('value', aiEval + '\nMatched: ' + (matchedPractices.length ? matchedPractices.join(', ') : 'None') + '\nTip: ' + feedbacks[current] + referral);
          answerInput.value = '';
          if (current < questions.length - 1) {
            answerFeedback.textContent = 'Ready for the next question?';
            setTimeout(() => {
              window.nextQuestion();
              answerFeedback.textContent = '';
              feedbackText.setAttribute('value', '');
            }, 2600);
          } else {
            // Show summary at the end
            setTimeout(() => showSummary(), 2000);
          }
        }

        // Show a summary of answers and encouragement
        function showSummary() {
          let summary = 'Interview Summary:\n';
          let total = 0;
          for (let i = 0; i < questions.length; i++) {
            summary += `\n${i+1}. ${questions[i]}\nYour answer: ${userAnswers[i] || ''}`;
            summary += `\nMatched best practices: `;
            let matched = [];
            const answerLower = (userAnswers[i] || '').toLowerCase();
            for (const practice of bestPractices) {
              if (answerLower.includes(practice)) matched.push(practice);
            }
            summary += matched.length ? matched.join(', ') : 'None';
            summary += `\nAI tip: ${feedbacks[i]}\n`;
            total += answerScores[i] || 0;
          }
          let maxScore = questions.length * bestPractices.length;
          let percent = Math.round((total / (questions.length * 3)) * 100); // 3+ best practices per answer is ideal
          let outcome = '';
          if (percent >= 80) {
            outcome = 'Outcome: Excellent! You are well prepared for interviews.';
          } else if (percent >= 50) {
            outcome = 'Outcome: Decent, but review your answers and try again for a higher score.';
          } else {
            outcome = 'Outcome: Needs improvement. Practice more detailed and specific answers.';
          }
          const integrityNotice = '\n\nIntegrity Notice: This feedback is generated automatically and is for practice only. For important interviews, use your own judgment or seek professional advice.';
          const encouragement = '\n\nThank you for practicing with us! Remember, every interview is a chance to grow. Explore our Resume Wizard, Training, and Resources tabs for more help. Youâ€™ve got this!';
          feedbackText.setAttribute('value', summary + `\n\nScore: ${percent}%\n${outcome}` + integrityNotice + encouragement);
          answerFeedback.textContent = 'Interview complete!';
          document.getElementById('welcome-text').setAttribute('value', 'Interview finished! See your results above.');
        }
        answerInput.addEventListener('keydown', function(e) {
          if (e.key === 'Enter') submitAnswer();
        });
      });
      </script>
      </script>
    </a-scene>
      <!-- Command Input Bar -->
        <!-- User Answer Input Bar -->
        <div id="answer-bar" style="position:fixed;bottom:70px;left:50%;transform:translateX(-50%);z-index:10;background:rgba(255,255,255,0.95);border-radius:8px;padding:8px 16px;box-shadow:0 2px 8px #7b2ff222;display:flex;gap:8px;align-items:center;">
          <input id="answer-input" type="text" placeholder="Type your answer here..." style="font-size:1.1rem;padding:6px 10px;border-radius:6px;border:1.5px solid #7b2ff2;width:320px;" />
          <button onclick="submitAnswer()">Submit</button>
          <span id="answer-feedback" style="color:#7b2ff2;font-size:1rem;margin-left:12px;"></span>
        </div>
      <div id="command-bar" style="position:fixed;bottom:24px;left:50%;transform:translateX(-50%);z-index:10;background:rgba(255,255,255,0.95);border-radius:8px;padding:8px 16px;box-shadow:0 2px 8px #7b2ff222;display:flex;gap:8px;align-items:center;">
        <input id="command-input" type="text" placeholder="Type a command (e.g. start, next, training, help)" style="font-size:1.1rem;padding:6px 10px;border-radius:6px;border:1.5px solid #7b2ff2;width:260px;" />
        <button onclick="handleCommand()">Send</button>
        <span id="command-feedback" style="color:#7b2ff2;font-size:1rem;margin-left:12px;"></span>
      </div>

  </body>
</html>
